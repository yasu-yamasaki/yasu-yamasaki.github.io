<!doctype html><html lang=jp><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content><title>Interfaceの戻り値を制限したい ｜ ヤス ブロ</title><meta name=description content="エンジニアリングとはなにか。 それは「曖昧さ」を減らし、「具体性」・「明確さ」を増やす行為です。 Interfaceの戻り値を制限し、 世の中の情"><link rel="shortcut icon" href=https://yasu-yamasaki.github.io/images/favicon.ico><link rel=stylesheet type=text/css media=screen href=https://yasu-yamasaki.github.io/css/normalize.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/animate.css@4.1.0/animate.min.css><link rel=stylesheet type=text/css media=screen href=https://yasu-yamasaki.github.io/css/zozo.css><link rel=stylesheet type=text/css media=screen href=https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css><link rel=stylesheet type=text/css media=screen href=https://yasu-yamasaki.github.io/css/highlight.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-824YMCP1EF"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag('js',new Date());gtag('config','G-824YMCP1EF');</script></head><body><div class="main animate__animated animate__fadeInDown"><div class="nav_container animated fadeInDown"><div class=site_nav id=site_nav><ul><li><a href=/>Home</a></li><li><a href=/posts/>Archive</a></li><li><a href=/tags/>Tags</a></li></ul></div><div class=menu_icon><a id=menu_icon><i class=ri-menu-line></i></a></div></div><div class="header animated fadeInDown"><div class=site_title_container><div class=site_title><h1><a href=https://yasu-yamasaki.github.io/><span>ヤス ブロ</span></a></h1></div><div class=description><p class=sub_title>ハードルは下げる。ネガティブなことは書かない。</p><div class=my_socials><a href=https://www.facebook.com/yasuyuki.yamasaki.79 title=facebook target=_blank><i class=ri-facebook-fill></i></a><a href=github title=github target=_blank><i class=ri-github-fill></i></a><a href=https://twitter.com/yasu_yamasaki title=twitter target=_blank><i class=ri-twitter-fill></i></a><a href=https://yasu-yamasaki.github.io/index.xml type=application/rss+xml title=rss target=_blank><i class=ri-rss-fill></i></a></div></div></div></div><div class=content><div class=post_page><div class="post animate__animated animate__fadeInDown"><div class="post_title post_detail_title"><h2><a href=/posts/202102/interface/>Interfaceの戻り値を制限したい</a></h2><span class=date>2021.01.24</span></div><div class="post_content markdown"><p>エンジニアリングとはなにか。<br>それは「曖昧さ」を減らし、「具体性」・「明確さ」を増やす行為です。<br>Interfaceの戻り値を制限し、 世の中の情報エントロピーを減少させましょう！</p><p>&mldr;</p><h2 id=背景>背景</h2><p>最近、私はこんなInterfaceに出会いました。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CoffeeMilkAnalyzer</span> {
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getCoffeeContentRate</span>(target: CoffeeMilk): BigDecimal
}
</code></pre></div><p>そこで私は思ったのは、 <code>getCoffeeContentRate</code> って、</p><ul><li>少数？（0 &lt;= x &lt;= 1）</li><li>パーセント？（0 &lt;= x &lt;= 100）</li></ul><p>まぁ十中八九、前者なんですが、若干、お前のこと信じてるぞ。みたいな気分になりますよね？<br>今日はそんな曖昧性と戦うため、３つの対策を紹介します。</p><h3 id=対策1コメントを入れる>対策1：コメントを入れる</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#75715e>/**
</span><span style=color:#75715e> * @return 0 &lt;= value &lt;= 1
</span><span style=color:#75715e> */</span>
<span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CoffeeMilkAnalyzer</span> {
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getCoffeeContentRate</span>(target: CoffeeMilk): BigDecimal
}
</code></pre></div><p>もうこれで、99.99%明確になりました。<br>でも、実装者が本当にこのコメント見て実装してくれてるかは謎です。</p><p>まぁ、この周辺でバグったら、とりあえずログ出してみる？とかなりますよね。</p><h3 id=対策2dataclassを使う>対策2：DataClassを使う</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin>
 <span style=color:#66d9ef>import</span> java.math.BigDecimalimport java.math.BigDecimalimport java.math.BigDecimalinterface CoffeeMilkAnalyzer {
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getCoffeeContentRate</span>(target: CoffeeMilk): CoffeeContentRate
    
    <span style=color:#66d9ef>data</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CoffeeContentRate</span>(
           <span style=color:#66d9ef>val</span> value: BigDecimal
    ) {
        <span style=color:#66d9ef>init</span> {
            require(value <span style=color:#f92672>&gt;=</span> BigDecimal.ZERO)
            require(value <span style=color:#f92672>&lt;=</span> BigDecimal.ONE)
        }
    }
}
</code></pre></div><p>完璧に制限できてます！<br>使う側の実装が若干汚くなっちゃうのが気になります。</p><h3 id=対策3bigdecimalを継承する>対策3：BigDecimalを継承する</h3><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-kotlin data-lang=kotlin><span style=color:#66d9ef>interface</span> <span style=color:#a6e22e>CoffeeMilkAnalyzer</span> {
    <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>getCoffeeContentRate</span>(target: CoffeeMilk): CoffeeContentRate
    
    <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>CoffeeContentRate</span>(<span style=color:#66d9ef>val</span> decimal: String)
        :BigDecimal(decimal) {
        <span style=color:#66d9ef>init</span> {
            require(<span style=color:#66d9ef>this</span> <span style=color:#f92672>&gt;=</span> BigDecimal.ZERO)
            require(<span style=color:#66d9ef>this</span> <span style=color:#f92672>&lt;=</span> BigDecimal.ONE)
        }

        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>toByte</span>(): Byte {
            <span style=color:#66d9ef>throw</span> UnsupportedOperationException()
        }
        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>toChar</span>(): Char {
            <span style=color:#66d9ef>throw</span> UnsupportedOperationException()
        }
        <span style=color:#66d9ef>override</span> <span style=color:#66d9ef>fun</span> <span style=color:#a6e22e>toShort</span>(): Short {
            <span style=color:#66d9ef>throw</span> UnsupportedOperationException()
        }
    }
}
</code></pre></div><p>完璧に制限できてます！<br>毎回定義が面倒とか、コンストラクタが文字列だけとかの問題は、
共通のMyDecimal型を定義して頑張ればいいかなと思います。</p><p>ただ、<br><code>toByte</code> <code>toChar</code> <code>toShort</code><br>これなんだ？</p><p>これについては次回、調べて報告します。</p><p>以上</p></div><div class=post_footer><div class=meta><div class=info><span class="field tags"><i class=ri-stack-line></i><a href=https://yasu-yamasaki.github.io/tags/kotlin/>Kotlin</a>
<a href=https://yasu-yamasaki.github.io/tags/tech/>Tech</a></span></div></div></div></div><div class=doc_comments></div></div></div></div><a id=back_to_top href=# class=back_to_top><i class=ri-arrow-up-s-line></i></a><footer class=footer><div class=powered_by><a href=https://varkai.com>Designed by VarKai,</a>
<a href=http://www.gohugo.io/>Proudly published with Hugo</a></div><div class=footer_slogan><span></span></div></footer><script src=https://yasu-yamasaki.github.io/js/jquery-3.5.1.min.js></script><link href=https://yasu-yamasaki.github.io/css/fancybox.min.css rel=stylesheet><script src=https://yasu-yamasaki.github.io/js/fancybox.min.js></script><script src=https://yasu-yamasaki.github.io/js/zozo.js></script></body></html>